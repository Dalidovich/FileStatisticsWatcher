@using FileStatisticsWatcher.Models.DTO;
@using FileStatisticsWatcher.Services;
@model DirectorySettings[]
<div style="display: flex;">
    <p style="display:inline-block; margin-right:10px">
        Directory count -
    </p>
    <p id="directoriesCount" style="display:inline-block">
        @Model.Length
    </p>
</div>

<table>
    <thead>
        <tr class="text-center">
            <th>Name</th>
            <th>Path</th>
            <th>DirictorySize</th>
            <th>FilesSize in dir</th>
            <th>CountFiles</th>
        </tr>
    </thead>
    <tbody id="directories">
        @await Html.PartialAsync("_directoriesSettings.cshtml",Model)
    </tbody>
</table>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    var page = 0;
    var _inCallback = false;
    function testLoad() {
    if (page > -1 && !_inCallback) {
        _inCallback = true;
        page++;
        $.ajax({
            type: 'GET',
            url: '/FileSettings/StatisticsForDirs',
            data: { "page": page },
            success: function (data, textstatus)
            {
                if (data != '') {
                    $("#directories").append(data);
                    $("#directoriesCount").html(Number($("#directoriesCount").html())+(data.match(/<td>/g) || []).length/5);
                }
                else {
                    page = -1;
                }
                _inCallback = false;
            }
        });
    }
}
function setFileScrollEvent() {
    $(window).scroll(function () {
        if ($(window).scrollTop() == $(document).height() - $(window).height()) {
            testLoad();
        }
    });
}
setFileScrollEvent();
</script>
